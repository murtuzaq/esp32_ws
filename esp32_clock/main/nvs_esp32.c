/**
 * @file nvs_esp32.c
 * @brief manages application use of nvs flash
 *
 */

/*****************************************************************************
 *	Private Includes
 *****************************************************************************/
#include "esp_log.h"
#include "nvs_flash.h"
/*****************************************************************************
 *	Private External References
 *****************************************************************************/

/*****************************************************************************
 *	Private Defines & Macros
 *****************************************************************************/
#define TAG	"app nvs"
/*****************************************************************************
 *	Private Typedefs & Enumerations
 *****************************************************************************/

/*****************************************************************************
 *	Private Variables
 *****************************************************************************/

/*****************************************************************************
 *	Private Function Prototypes
 *****************************************************************************/

/*****************************************************************************
 *	Public Functions
 *****************************************************************************/
/*****************************************************************************
 *  nvs_esp32_init
 *  Parameters:
 *    none
 *  Returns:
 *    none
 *  Description:
 *    Initialize module here
 *****************************************************************************/
void nvs_esp32_init(void)
{
    esp_err_t ret;

    ret = nvs_flash_init();

    if (ret == ESP_ERR_NVS_NO_FREE_PAGES || ret == ESP_ERR_NVS_NEW_VERSION_FOUND)
    {
      ESP_LOGW(TAG, "error, nvs flash erase");

      ESP_ERROR_CHECK(nvs_flash_erase());
      ret = nvs_flash_init();
    }

    ESP_ERROR_CHECK(ret);

    ESP_LOGI(TAG, "init complete");


}

/*****************************************************************************
 *	Private Functions
 *****************************************************************************/


